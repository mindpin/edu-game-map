{"version":3,"sources":["curve-arrow.coffee"],"names":[],"mappings":"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","file":"curve-arrow.js","sourceRoot":"/source/","sourcesContent":["class CurveArrow\r\n  constructor: (@canvas)->\r\n    # nothing\r\n\r\n  draw: (x0, y0, x1, y1, color)->\r\n    # console.log '绘制曲线箭头', [x0, y0], [x1, y1]\r\n\r\n    W = x1 - x0\r\n    H = y1 - y0\r\n    L = Math.pow Math.pow(H, 2) + Math.pow(W, 2), 0.5\r\n\r\n    # 计算曲线辅助点\r\n    l = 10\r\n    # l = L / 3\r\n    dx = l * H / L\r\n    dy = l * W / L\r\n    xm = (x0 + x1) / 2 + dx\r\n    ym = (y0 + y1) / 2 - dy\r\n\r\n    ctx = @canvas.getContext '2d'\r\n    ctx.fillStyle = color\r\n    ctx.strokeStyle = color\r\n    ctx.lineWidth = 4\r\n    ctx.lineCap = 'round'\r\n\r\n    # ctx.beginPath()\r\n    # ctx.arc x0, y0, 3, 0, Math.PI, false\r\n    # ctx.closePath()\r\n    # ctx.fill()\r\n\r\n    ctx.beginPath()\r\n    ctx.moveTo x0, y0\r\n    ctx.quadraticCurveTo xm, ym, x1, y1\r\n    ctx.stroke()\r\n\r\n    # 画箭头\r\n    xp = (x0 + x1) / 2 + dx / 2\r\n    yp = (y0 + y1) / 2 - dy / 2\r\n\r\n    hx = 6\r\n    ang = Math.atan ~~(xp - x1) / ~~(y1 - yp)\r\n    ang += Math.PI if yp > y1\r\n    # ang -= Math.PI / 2\r\n\r\n    # console.log ang\r\n\r\n    ctx.save()\r\n    ctx.translate x1, y1\r\n    ctx.rotate ang\r\n    ctx.beginPath()\r\n    ctx.moveTo -hx/1.2, -hx\r\n    ctx.lineTo 0, 0\r\n    ctx.lineTo hx/1.2, -hx\r\n    ctx.stroke()\r\n    ctx.restore()\r\n\r\n\r\nwindow.CurveArrow = CurveArrow"]}